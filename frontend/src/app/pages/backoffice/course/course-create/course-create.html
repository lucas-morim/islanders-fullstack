<section class="page-header sticky-top-under-app">
  <div class="d-flex align-items-center justify-content-between">
    <h2 class="mb-0">Novo curso</h2>
    <div class="d-flex gap-2">
      <ng-template #saving>
        <span class="spinner-border spinner-border-sm me-1"></span> Salvando‚Ä¶
      </ng-template>
    </div>
  </div>
</section>

<form [formGroup]="form" novalidate>
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="row g-3">

        <div class="col-12 col-md-3">
          <label class="form-label">Capa do curso</label>
          <div class="avatar-uploader">
            <img *ngIf="coverPreview(); else coverPlaceholder"
                 [src]="coverPreview()"
                 alt="Preview"
                 class="avatar-preview rounded">
            <ng-template #coverPlaceholder>
              <div class="avatar-placeholder rounded">üìò</div>
            </ng-template>
          </div>
          <input class="form-control mt-2"
                 type="file"
                 accept="image/*"
                 (change)="onCoverChange($event)">
          <div class="form-text">PNG/JPG at√© 2MB</div>
        </div>

        <div class="col-12 col-md-9">
          <div class="row g-3">

            <div class="col-12">
              <label class="form-label">T√≠tulo</label>
              <input class="form-control"
                     formControlName="title"
                     placeholder="Ex.: Engenharia Inform√°tica">
              <div class="invalid-feedback d-block"
                   *ngIf="f['title'].touched && f['title'].errors">
                {{ f['title'].errors['required'] ? 'T√≠tulo √© obrigat√≥rio.' : '' }}
                {{ f['title'].errors['maxlength'] ? 'M√°ximo de 50 caracteres.' : '' }}
              </div>
            </div>

            <div class="col-12 col-lg-4">
              <label class="form-label">Modalidade</label>
              <select class="form-select" formControlName="modality_id">
                <option value="">Selecione‚Ä¶</option>
                <option *ngFor="let m of modalities()" [value]="m.id">
                  {{ m.name }}
                </option>
              </select>
            </div>

            <div class="col-12 col-lg-4">
              <label class="form-label">Status</label>
              <select class="form-select" formControlName="status">
                <option value="active">Ativo</option>
                <option value="inactive">Inativo</option>
              </select>
            </div>

            <div class="col-12 col-lg-4">
                <label class="form-label">√Åreas</label>

                <div class="dropdown w-100">
                    <button
                    class="btn btn-outline w-100 d-flex justify-content-between align-items-center"
                    type="button"
                    data-coreui-toggle="dropdown"
                    aria-expanded="false">

                    <span class="areas-label flex-grow-1 text-truncate text-start">
                        {{ selectedAreasLabel() }}
                    </span>

                    <span class="dropdown-toggle dropdown-caret-only ms-2 flex-shrink-0"></span>
                    </button>

                    <ul class="dropdown-menu w-100">
                    <li *ngFor="let a of areas()">
                        <label class="dropdown-item d-flex align-items-center gap-2">
                        <input
                            type="checkbox"
                            class="form-check-input"
                            [checked]="isAreaSelected(a.id)"
                            (change)="toggleArea(a.id, $event.target.checked)">
                        <span>{{ a.name }}</span>
                        </label>
                    </li>
                    </ul>
                </div>

            </div>

            <div class="col-12"> 
              <label class="form-label">Descri√ß√£o</label>
              <textarea class="form-control"
                        rows="3"
                        formControlName="description"
                        placeholder="Descri√ß√£o resumida do curso, objetivos, p√∫blico-alvo‚Ä¶"></textarea>
            </div>

            <div class="col-12">
              <label class="form-label">Conte√∫dos Program√°ticos</label>
              <textarea class="form-control"
                        rows="4"
                        formControlName="content"
                        placeholder="Conte√∫do program√°tico do curso‚Ä¶"></textarea>
            </div>

            <div class="col-12">
              <label class="form-label">Destinat√°rios</label>
              <textarea class="form-control"
                        rows="3"
                        formControlName="target"
                        placeholder="A quem se destina este curso‚Ä¶"></textarea>
            </div>

            <div class="col-12 col-lg-6">
              <label class="form-label">Data/Info de in√≠cio</label>
              <input type="text"
                    class="form-control"
                    formControlName="start_info"
                    placeholder="Ex.: 21/05/2026 ou 'Em breve' ou 'A definir'">
              <div class="form-text">Pode ser uma data ou texto informativo</div>
            </div>

            <div class="col-12 col-lg-4">
              <label class="form-label">Carga hor√°ria (horas)</label>
              <input type="number"
                     class="form-control"
                     formControlName="num_hours"
                     placeholder="Ex.: 40">
              <div class="invalid-feedback d-block"
                   *ngIf="f['num_hours'].touched && f['num_hours'].errors">
                {{ f['num_hours'].errors['min'] ? 'N√£o pode ser negativo.' : '' }}
              </div>
            </div>

            <div class="col-12 col-lg-4">
              <label class="form-label">Cr√©ditos</label>
              <input type="number"
                     class="form-control"
                     formControlName="credits"
                     placeholder="Ex.: 4">
              <div class="invalid-feedback d-block"
                   *ngIf="f['credits'].touched && f['credits'].errors">
                {{ f['credits'].errors['min'] ? 'N√£o pode ser negativo.' : '' }}
              </div>
            </div>

            <div class="col-12 col-lg-4">
              <label class="form-label">Pre√ßo</label>
              <div class="input-group">
                <span class="input-group-text">‚Ç¨</span>
                <input type="number"
                       step="0.01"
                       class="form-control"
                       formControlName="price"
                       placeholder="Ex.: 199.90">
              </div>
              <div class="invalid-feedback d-block"
                   *ngIf="f['price'].touched && f['price'].errors">
                {{ f['price'].errors['min'] ? 'N√£o pode ser negativo.' : '' }}
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <div class="card-body d-flex justify-content-end gap-2 border-top bg-white">
      <button class="btn btn-outline-secondary" type="button" (click)="cancel()">Cancelar</button>
      <button class="btn btn-primary isla-color-bg"
              type="button"
              [disabled]="!canSubmit()"
              (click)="submit()">
        <span *ngIf="!submitting(); else saving2">Salvar</span>
      </button>
      <ng-template #saving2>
        <span class="spinner-border spinner-border-sm me-1"
              role="status"
              aria-hidden="true"></span>
        Salvando‚Ä¶
      </ng-template>
    </div>
  </div>
</form>
